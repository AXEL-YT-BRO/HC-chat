<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YT Video Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: radial-gradient(circle at top left, #1a1a2e, #16213e);
            height: 100dvh;
            overflow: hidden;
            color: #e2e8f0;
        }
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .chat-container::-webkit-scrollbar { width: 4px; }
        .chat-container::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
        .loader {
            border-top-color: #3b82f6;
            animation: spinner 0.6s linear infinite;
        }
        @keyframes spinner { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="flex flex-col font-sans">

    <header class="p-4 glass flex justify-between items-center z-10">
        <h1 class="text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
            YT Chat Hacker
        </h1>
        <button onclick="toggleModal('settings-modal')" class="p-2 hover:text-blue-400 transition-colors">
            <i class="fas fa-cog text-xl"></i>
        </button>
    </header>

    <main id="chat-box" class="flex-1 overflow-y-auto p-4 space-y-4 chat-container">
        <div class="glass p-3 rounded-2xl max-w-[85%] self-start text-sm">
            Hello! Paste a YouTube URL below to "hack" the transcript and start chatting.
        </div>
    </main>

    <div id="loader" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center">
        <div class="loader w-12 h-12 border-4 border-white/20 rounded-full"></div>
    </div>

    <section class="p-4 space-y-3 glass rounded-t-3xl shadow-2xl">
        <div id="video-input-area" class="flex gap-2">
            <input type="text" id="yt-url" placeholder="Paste YouTube URL..." 
                class="flex-1 bg-white/10 border border-white/20 rounded-xl px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
            <button onclick="loadVideo()" class="bg-blue-600 hover:bg-blue-500 px-4 py-2 rounded-xl text-sm font-bold transition-all">
                Load
            </button>
        </div>
        
        <div id="chat-input-area" class="flex gap-2 hidden">
            <input type="text" id="user-msg" placeholder="Ask about the video..." 
                class="flex-1 bg-white/10 border border-white/20 rounded-xl px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
            <button onclick="sendMessage()" class="bg-purple-600 hover:bg-purple-500 px-4 py-2 rounded-xl text-sm font-bold transition-all">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </section>

    <div id="settings-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-6 bg-black/80 backdrop-blur-sm">
        <div class="glass w-full max-w-sm p-6 rounded-3xl space-y-4">
            <div class="flex justify-between items-center">
                <h2 class="text-lg font-bold">API Settings</h2>
                <button onclick="toggleModal('settings-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div>
                <label class="text-xs uppercase text-gray-400 mb-1 block">OpenRouter API Key</label>
                <input type="password" id="api-key" class="w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-blue-500">
            </div>
            <div>
                <label class="text-xs uppercase text-gray-400 mb-1 block">Model Name</label>
                <input type="text" id="model-name" placeholder="e.g., google/gemini-2.0-flash-001" 
                    class="w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-blue-500">
            </div>
            <button onclick="saveSettings()" class="w-full bg-blue-600 py-2 rounded-xl font-bold mt-2">Save Configuration</button>
        </div>
    </div>

    <script>
        let videoContext = "";
        const chatBox = document.getElementById('chat-box');
        const loader = document.getElementById('loader');

        // Load saved settings
        window.onload = () => {
            document.getElementById('api-key').value = localStorage.getItem('or_key') || '';
            document.getElementById('model-name').value = localStorage.getItem('or_model') || 'google/gemini-2.0-flash-001';
        };

        function toggleModal(id) {
            document.getElementById(id).classList.toggle('hidden');
        }

        function saveSettings() {
            localStorage.setItem('or_key', document.getElementById('api-key').value);
            localStorage.setItem('or_model', document.getElementById('model-name').value);
            toggleModal('settings-modal');
            alert('Settings Saved!');
        }

        function appendMessage(role, text) {
            const div = document.createElement('div');
            div.className = `p-3 rounded-2xl max-w-[85%] text-sm ${role === 'user' ? 'glass ml-auto border-blue-500/30' : 'bg-white/10 mr-auto'}`;
            div.innerText = text;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        async function loadVideo() {
            const url = document.getElementById('yt-url').value;
            if (!url) return alert("Please paste a URL");

            loader.classList.remove('hidden');
            try {
                const response = await fetch(`https://r.jina.ai/${url}`);
                videoContext = await response.text();
                
                appendMessage('system', "Video content loaded! The 'hack' was successful. You can now chat with the video.");
                document.getElementById('video-input-area').classList.add('hidden');
                document.getElementById('chat-input-area').classList.remove('hidden');
            } catch (err) {
                alert("Failed to fetch transcript. Check URL or Jina API status.");
            } finally {
                loader.classList.add('hidden');
            }
        }

        async function sendMessage() {
            const input = document.getElementById('user-msg');
            const question = input.value;
            const apiKey = localStorage.getItem('or_key');
            const model = localStorage.getItem('or_model');

            if (!question) return;
            if (!apiKey) return toggleModal('settings-modal');

            appendMessage('user', question);
            input.value = "";
            loader.classList.remove('hidden');

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${apiKey}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "model": model,
                        "messages": [
                            {"role": "system", "content": `You are a helpful assistant. Use this video transcript to answer: ${videoContext}`},
                            {"role": "user", "content": question}
                        ]
                    })
                });

                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                appendMessage('ai', aiResponse);
            } catch (err) {
                appendMessage('system', "Error connecting to OpenRouter. Check your API key and Model Name.");
            } finally {
                loader.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
